<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Книжный магазин</title>
</head>
<body>
    <h1>Книжный магазин</h1>
    
    <input type="text" id="bookInput" placeholder="Введите название книги">
    <button onclick="searchBooks()">Поиск</button>
    
    <div id="bookList"></div>

    <script>
        async function searchBooks() {
            const bookInput = document.getElementById('bookInput').value;
            const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${bookInput}`);
            const data = await response.json();
            displayBooks(data.items);
        }

        function displayBooks(books) {
            const bookList = document.getElementById('bookList');
            bookList.innerHTML = '';
            books.forEach(book => {
                const title = book.volumeInfo.title;
                const authors = book.volumeInfo.authors ? book.volumeInfo.authors.join(', ') : 'Unknown';
                const buyButton = `<button onclick="showForm('${title}', '${authors}')">Купить</button>`;
                bookList.innerHTML += `<div><strong>${title}</strong> - ${authors} ${buyButton}</div>`;
            });
        }

        function showForm(title, authors) {
            const form = document.createElement('form');
            form.id = 'purchaseForm';
            form.onsubmit = (event) => submitForm(event, title, authors);

            form.innerHTML = `
                <label for="name">Имя:</label><br>
                <input type="text" id="name"><br>
                <label for="email">Почта:</label><br>
                <input type="text" id="email"><br>
                <label for="phone">Телефон:</label><br>
                <input type="text" id="phone"><br>
                <label for="address">Адрес:</label><br>
                <input type="text" id="address"><br><br>
                <button type="submit">Отправить</button>
            `;

            bookList.appendChild(form);
        }

        async function submitForm(event, title, authors) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const bookInfo = `Книга: ${title}, Автор(ы): ${authors}`;
            const formData = { name, email, phone, address, bookInfo };
            
            // Отправка данных на Google Sheets
            await fetch('https://script.google.com/macros/s/AKfycbyG6FVKl2PgkHL4-3UgZuCHqD5Nj-DbsWD_NmSgsqY/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            alert('Заказ успешно отправлен!');
            document.getElementById('purchaseForm').reset();
        }
    </script>
</body>
</html>
